---
name: Build and Publish Repository
on:
  push:
    branches:
      - "master"
      - "prerelease"
permissions:
  contents: write
  issues: write
  pull-requests: write
jobs:
  build:
    uses: aps831/workflows/.github/workflows/build-and-publish-terraform.yaml@feat/deploy
    with:
      terraform-version: "1.4.2"
      paths: |
        moduleA
        moduleB
      tfvars-filename: "terraform.tfvars"
      tfvars-update-values: "tag|v[[:digit:]]+\\.[[:digit:]]+\\.[[:digit:]]+|v2.7.9"
    secrets:
      ACCESS_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  # TODO delete
  record:
    runs-on: ubuntu-latest
    steps:
      - uses: aps831/gh-actions/deployment-record-pub@feat/deploy
        with:
          target-owner: "aps831"
          target-repo: "workflows-testbed-basic"
          target-workflow: "deployment-record-sub.yaml"
          target-branch: "master"
          tag: "v1.7.5"
          env: "dev"
          timestamp: "240110120305"
          message: "hello, world"
